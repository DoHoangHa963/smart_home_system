#file: noinspection SpringBootApplicationYaml
server:
  port: 8080
  servlet:
    context-path: /api

app:
  base-url: http://localhost:8080
  mcu:
    heartbeat-check-interval-ms: 120000  # 2 phút: đánh dấu MCU offline nếu không có heartbeat/LWT

spring:
  datasource:
    url: "jdbc:mysql://localhost:3307/smart_home?createDatabaseIfNotExist=true"
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      # Connection pool configuration - Tăng pool size để xử lý nhiều request đồng thời
      maximum-pool-size: 50  # Tăng lên 50 để xử lý nhiều request đồng thời (polling + SSE)
      minimum-idle: 10  # Tăng minimum idle để có sẵn connections
      connection-timeout: 30000  # 30s timeout
      idle-timeout: 300000  # 5 phút - đóng connections không sử dụng
      max-lifetime: 1800000  # 30 phút - thời gian tối đa một connection có thể sống
      leak-detection-threshold: 60000  # 60s để phát hiện leak
      connection-test-query: SELECT 1  # Test query để đảm bảo connection còn hoạt động
      pool-name: SmartHomeHikariPool
      # Tăng registerMbeans để monitor pool
      register-mbeans: true
      # Tối ưu cho MySQL
      data-source-properties:
        cachePrepStmts: true
        prepStmtCacheSize: 250
        prepStmtCacheSqlLimit: 2048
        useServerPrepStmts: true
        useLocalSessionState: true
        rewriteBatchedStatements: true
        cacheResultSetMetadata: true
        cacheServerConfiguration: true
        elideSetAutoCommits: true
        maintainTimeStats: false

  jpa:
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        dialect: org.hibernate.dialect.MySQL8Dialect

  jackson:
    default-property-inclusion: non_null
    serialization:
      write-dates-as-timestamps: false
    date-format: "yyyy-MM-dd HH:mm:ss"

  servlet:
    multipart:
      max-file-size: 5MB
      max-request-size: 10MB

logging:
  level:
    org.springframework.security: WARN  # Giảm từ DEBUG xuống WARN để giảm log
    org.springframework.security.web.FilterChainProxy: WARN  # Giảm log filter chain
    org.springframework.security.web.access: WARN  # Giảm log authorization
    org.springframework.security.web.authentication: WARN  # Giảm log authentication
    org.hibernate.engine.jdbc.spi.SqlExceptionHelper: WARN  # Chỉ log WARN và ERROR
    com.zaxxer.hikari.pool.ProxyLeakTask: WARN  # Connection leak warnings
    com.example.smart_home_system.configuration: INFO  # Giảm từ DEBUG xuống INFO
    com.example.smart_home_system.service: INFO  # Service layer logs
    com.example.smart_home_system.controller: INFO  # Controller logs
    com.example.smart_home_system.service.implement.MqttMessageHandler: INFO  # MQTT handler logs
    com.example.smart_home_system.config.MqttConfig: INFO  # MQTT config logs
    org.springframework.integration.mqtt: INFO  # Spring Integration MQTT logs
    org.eclipse.paho.client.mqttv3: WARN  # MQTT client logs (reduce noise)
    org.hibernate.SQL: OFF
    org.hibernate.orm.jdbc.bind: OFF   # Hibernate 6
    org.hibernate.type.descriptor.sql: OFF  # Hibernate 5
    root: INFO

file:
  upload-dir: uploads
  max-size: 5MB
  allowed-extensions: jpg,jpeg,png,gif

mqtt:
  broker-url: tcp://192.168.0.200:1883
  client-id: smarthome-backend
  username: ""  # Leave empty for no auth
  password: ""
  default-qos: 1
  # Topic structure:
  # - smarthome/{homeId}/commands - Backend publishes commands to ESP32
  # - smarthome/{homeId}/sensors - ESP32 publishes sensor data
  # - smarthome/{homeId}/rfid/# - RFID events
  # - smarthome/{homeId}/status - Device online/offline status

jwt:
  expiration: 36000 #in seconds
  refreshable-duration: 100000 # in seconds
  secret: "cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e"